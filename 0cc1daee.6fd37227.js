(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{104:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return c}));var a=n(2),o=(n(0),n(156));const r={title:"Workflow Templates",sidebar_label:"Workflow Templates",description:"Workflow Templates for training models, ETL tasks and more on Onepanel"},i={id:"reference/workflows/templates",title:"Workflow Templates",description:"Workflow Templates for training models, ETL tasks and more on Onepanel",source:"@site/docs/reference/workflows/templates.md",permalink:"/docs/reference/workflows/templates",editUrl:"https://github.com/onepanelio/core-docs/tree/master/docs/reference/workflows/templates.md",sidebar_label:"Workflow Templates",sidebar:"reference",previous:{title:"Terminating a Workspace",permalink:"/docs/reference/workspaces/delete"},next:{title:"Creating a Workflow Template",permalink:"/docs/reference/workflows/create"}},s=[{value:"Getting started with Workflow Templates",id:"getting-started-with-workflow-templates",children:[]},{value:"Parameters",id:"parameters",children:[]},{value:"Artifacts",id:"artifacts",children:[{value:"Git integration with Workflows",id:"git-integration-with-workflows",children:[]},{value:"Archive",id:"archive",children:[]},{value:"Optional",id:"optional",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}]}],l={rightToc:s};function c({components:e,...t}){return Object(o.b)("wrapper",Object(a.a)({},l,t,{components:e,mdxType:"MDXLayout"}),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"See our ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/onepanelio/templates/tree/master/workflows"}),"Templates repository")," for a list of ready to use Workflow Templates. You can also use these as reference for defining youur own Workflow Templates."))),Object(o.b)("h2",{id:"getting-started-with-workflow-templates"},"Getting started with Workflow Templates"),Object(o.b)("p",null,"You can define reusable templates for Workflows. All Workflow Templates are defined as Directed Acyclic Graphs (DAG), here's an example of how a DAG template is defined:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'# The template to use as entrypoint\nentrypoint: main\ntemplates:\n- name: main            \n  dag:                      # Indicates that this is a DAG template\n    tasks:\n    - name: A               # First task to execute\n      template: echo        # The template to use for first task in DAG\n      arguments:            # Arguments to pass into the "echo" template\n        parameters:\n        - name: message\n          value: A\n    - name: B\n      dependencies: [A]\n      template: echo\n      arguments:\n        parameters:\n        - name: message\n          value: B\n    - name: C\n      dependencies: [A]\n      template: echo\n      arguments:\n        parameters:\n        - name: message\n          value: C\n    - name: D\n      dependencies: [B, C]\n      template: echo\n      arguments:\n        parameters:\n        - name: message\n          value: D\n- name: echo                # Definition of "echo" template used by the nodes in DAG\n  inputs:                   # Name of inputs \n    parameters:\n    - name: message\n  container:\n    image: alpine:3.7\n    command: [echo, "{{inputs.parameters.message}}"]\n')),Object(o.b)("h2",{id:"parameters"},"Parameters"),Object(o.b)("p",null,"You can define and use parameters in your Workflow Templates. These parameters are displayed in the Workflow creation form (or are made available via CLI) and can be referenced in the template like so:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"'{{workflow.parameters.<parameter-name>}}'\n")),Object(o.b)("p",null,"The syntax for parameter definitions are as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"arguments:\n  parameters:\n  - name: storage-class # Name, only alphanumeric characters and `-` allowed (required)\n    value: ssd  # Default value (required)\n    displayName: Storage class\n    type: select.select # How to render this parameter in Workflow creation form in Web UI\n    options:  # type of select.select and input.radio allow you to set options\n    - name: SSD\n      value: ssd\n")),Object(o.b)("p",null,"If a parameter is defined, ",Object(o.b)("inlineCode",{parentName:"p"},"name")," and ",Object(o.b)("inlineCode",{parentName:"p"},"value")," are required."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"name")," is the name of the parameters, only alphanumeric characters and ",Object(o.b)("inlineCode",{parentName:"li"},"-")," allowed"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"value")," is the default value for the parameter"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"displayName")," is the text that is displayed to the user"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"type")," indicates how the parameter is rendered in the Workflow creation form in the Web UI. Possible values are:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"input.text")," renders a textbox"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"input.number")," renders a textbox that only accepts numbers"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"input.radio")," renders radio buttons"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"select.select")," renders a dropdown"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"textarea.textarea")," renders a textarea"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"options")," define options if ",Object(o.b)("inlineCode",{parentName:"li"},"type")," is ",Object(o.b)("inlineCode",{parentName:"li"},"select.select")," or ",Object(o.b)("inlineCode",{parentName:"li"},"input.radio"))),Object(o.b)("p",null,"Example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:"{3-11,22}","{3-11,22}":!0}),"arguments:\n  parameters:\n  - name: message-text\n    value: my-message-2 # default value\n    displayName: Message text\n    type: select.select\n    options:\n    - name: my-message-1\n      value: my-message-1\n    - name: my-message-2\n      value: my-message-2\nentrypoint: main\ntemplates:\n- name: main\n  dag:\n    tasks:\n    - name: A\n      template: echo\n      arguments:\n        parameters:\n        - name: message\n          value: '{{workflow.parameters.message-text}}'\n")),Object(o.b)("h2",{id:"artifacts"},"Artifacts"),Object(o.b)("p",null,"When running Workflows, it is very common to have steps that generate or consume artifacts. Often, the output artifacts of one task may be used as input artifacts to a subsequent task."),Object(o.b)("p",null,"Example below shows how you can download or upload artifacts from or to different object storage locations:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"entrypoint: main\narguments:\n  # Workflow parameters which will be set by user via Web UI, SDK or API\n  parameters:\n  - name: model-path\n    value: my-data/output\ntemplates:\n- name: main\n  dag:\n    tasks:\n    - name: input-output\n      template: input-output\n- name: input-output\n  container:\n    args:\n    - |\n      printenv \\\n      && ls /tmp/input \\\n        && mkdir -p /tmp/output \\\n        && echo \"hello\" > /tmp/output/message.txt \\\n        && sleep 15\n    command:\n    - bash\n    - -c\n    image: bash\n  inputs:\n    artifacts:\n    # Download files from S3 prefix random/input into local folder /tmp/input/\n    # # This downloads from the default S3 artifact repository for this namespace\n    - name: input\n      path: /tmp/input/\n      s3:\n        key: my-data/input\n  outputs:\n    artifacts:\n    # Upload files from local /tmp/output folder to default object storage location that is configured for this namespace\n    # This is set to artifacts/{{workflow.namespace}}/{{workflow.name}}/{{pod.name}} by default\n    - name: output-one\n      path: /tmp/output\n    # Upload files from local /tmp/output folder to S3 prefix my-data/output\n    # This uploads to the default S3 artifact repository for this namespace\n    - name: output-two\n      path: /tmp/output\n      s3:\n        # Reference to the Workflow parameter that was set by user\n        key: '{{workflow.parameters.model-path}}'\n    # Upload files from local /tmp/output folder to the S3 prefix my-data/output in bucket defined below\n    - name: output-three\n      path: /tmp/output\n      s3:\n        key: '{{workflow.parameters.model-path}}'\n        endpoint: storage.googleapis.com\n        bucket: my-bucket-name\n        accessKeySecret:\n          name: my-s3-credentials\n          key: accessKey\n        secretKeySecret:\n          name: my-s3-credentials\n          key: secretKey\n\n")),Object(o.b)("p",null,"Using GCS"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"...\n    - name: output-three\n      path: /tmp/output\n      gcs:\n        bucket: bucketofplenty\n        key: /your/path\n        serviceAccountKeySecret:\n          name: onepanel\n          key: serviceAccountKey\n")),Object(o.b)("h3",{id:"git-integration-with-workflows"},"Git integration with Workflows"),Object(o.b)("p",null,"You can also attach git repository (i.e Github) as an input artifact as follows."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'inputs:\n    artifacts:\n    - git:\n        repo: https://github.com/onepanelio/Mask_RCNN.git\n        revision: "no-boto"\n      name: src\n      path: /mnt/src\n')),Object(o.b)("p",null,"Here, we specified Github repository along with branch (",Object(o.b)("inlineCode",{parentName:"p"},"no-boto"),"). ",Object(o.b)("inlineCode",{parentName:"p"},"path")," specifies where to mount this repository."),Object(o.b)("p",null,"You can also use private repository with Workflows. For that, you first need to ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token"}),"create personal access token")," from Github. Then, go to ",Object(o.b)("inlineCode",{parentName:"p"},"Settings")," and add following two environment variables. ",Object(o.b)("inlineCode",{parentName:"p"},"GITHUB_USERNAME")," and ",Object(o.b)("inlineCode",{parentName:"p"},"GITHUB_PASSWORD"),". For ",Object(o.b)("inlineCode",{parentName:"p"},"GITHUB_PASSWORD"),", you should be using your personal access token. Once this is done, you can modify above yaml section as follows to use private repository."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'inputs:\n    artifacts:\n    - git:\n        repo: https://github.com/onepanelio/Mask_RCNN.git\n        revision: "no-boto"\n        usernameSecret:\n            name: onepanel-default-env\n            key: GITHUB_USERNAME\n        passwordSecret:\n            name: onepanel-default-env\n            key: GITHUB_PASSWORD\n      name: src\n      path: /mnt/src\n')),Object(o.b)("h3",{id:"archive"},"Archive"),Object(o.b)("p",null,"Artifacts can be packaged as Tarballs and gzipped by specifying an archive strategy, using the ",Object(o.b)("inlineCode",{parentName:"p"},"archive")," field:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"...\n  outputs:\n    artifacts:\n    # Upload files from local /tmp/output folder to default object storage location that is configured for this namespace\n    # This is set to artifacts/{{workflow.namespace}}/{{workflow.name}}/{{pod.name}} by default\n    - name: output-one\n      path: /tmp/output\n      # Tar and gzip contents of /tmp/output folder and upload to the namespace configured artifact repository\n      archive:\n        tar: {}\n...\n")),Object(o.b)("h3",{id:"optional"},"Optional"),Object(o.b)("p",null,"You can also mark both input and output artifacts as optional by setting ",Object(o.b)("inlineCode",{parentName:"p"},"optional")," to ",Object(o.b)("inlineCode",{parentName:"p"},"true"),". In this case, if they don't exist, the Workflow will not throw an error:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"...\n  inputs:\n    artifacts:\n    # Download files from S3 prefix random/input into local folder /tmp/input/\n    # # This downloads from the default S3 artifact repository for this namespace\n    - name: input\n      path: /tmp/input/\n      optional: true # Don't throw an error if the file doesn't exist in the S3 location\n      s3:\n        key: my-data/input\n...\n")),Object(o.b)("h3",{id:"troubleshooting"},"Troubleshooting"),Object(o.b)("p",null,"Following is a list of common problems that you may encounter while working with workflows and solutions for them."),Object(o.b)("h4",{id:"1---failed-with-exit-code-x-ie-1"},"1 - failed with exit code 'x' (i.e 1)"),Object(o.b)("p",null,"This usually happens when there is an error in the script/code you are trying to run. Usually, taking a look at logs and solving the errors reported will work."),Object(o.b)("h4",{id:"2---failed-to-load-artifacts-timed-out-waiting-for-the-condition"},"2 - failed to load artifacts: timed out waiting for the condition"),Object(o.b)("p",null,"This happens when artifacts could not be mounted to the machine. A common case when this happens is when you are tring to attach data larger than your disk size. Try increasing your disk space. "),Object(o.b)("h4",{id:"3---failed-to-load-artifacts-the-specified-key-does-not-exist"},"3 - failed to load artifacts: The specified key does not exist"),Object(o.b)("p",null,"You will encounter this error when you are trying to attach data which does not exists. Look at the name and path of file(s)."),Object(o.b)("h4",{id:"4---the-node-was-low-on-resource-memory-container-wait-was-using-20172ki-which-exceeds-its-request-of-0-container-main-was-using-11074832ki-which-exceeds-its-request-of-0"},"4 - The node was low on resource: memory. Container wait was using 20172Ki, which exceeds its request of 0. Container main was using 11074832Ki, which exceeds its request of 0"),Object(o.b)("p",null,"This happens when you are trying to run code which is compute intensive and you don't have enough compute attached to your cluster."))}c.isMDXComponent=!0},156:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return b}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=o.a.createContext({}),p=function(e){var t=o.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=p(e.components);return o.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,b=m["".concat(i,".").concat(d)]||m[d]||u[d]||r;return n?o.a.createElement(b,s(s({ref:t},c),{},{components:n})):o.a.createElement(b,s({ref:t},c))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);